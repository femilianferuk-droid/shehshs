<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonkeyGram - –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä üêµ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .app-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            min-height: 700px;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #e9ecef;
        }

        .main-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .module-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .module-title {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 1.3rem;
        }

        .function-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .function-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .function-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .function-card h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .function-card button {
            width: 100%;
            padding: 8px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .function-card button:hover {
            background: #5a67d8;
        }

        .demo-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #667eea;
        }

        .demo-controls h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #495057;
            font-weight: 500;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1rem;
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .log-output {
            margin-top: 20px;
            padding: 15px;
            background: #1a1a1a;
            color: #00ff00;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .user-info {
            background: #667eea;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .status-online {
            color: #28a745;
            font-weight: bold;
        }

        .status-offline {
            color: #dc3545;
            font-weight: bold;
        }

        .monkey-icon {
            font-size: 2.5rem;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .function-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="monkey-icon">üêµ</span> MonkeyGram</h1>
            <p>–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ</p>
        </div>

        <div class="app-container">
            <div class="sidebar">
                <div class="user-info" id="userInfo">
                    <h3>–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</h3>
                    <p>–°—Ç–∞—Ç—É—Å: <span id="userStatus" class="status-offline">–û—Ñ—Ñ–ª–∞–π–Ω</span></p>
                </div>

                <div class="module-section">
                    <h3 class="module-title">–ú–æ–¥—É–ª–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞</h3>
                    <div class="button-group" style="flex-direction: column;">
                        <button class="btn btn-primary" onclick="showModule('core')">Core (–ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)</button>
                        <button class="btn btn-primary" onclick="showModule('experience')">Experience (–û–±—â–µ–Ω–∏–µ)</button>
                        <button class="btn btn-primary" onclick="showModule('security')">Security (–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)</button>
                        <button class="btn btn-primary" onclick="showModule('productivity')">Productivity</button>
                        <button class="btn btn-primary" onclick="showModule('customization')">Customization</button>
                        <button class="btn btn-primary" onclick="showModule('technical')">Technical</button>
                    </div>
                </div>

                <div class="module-section">
                    <h3 class="module-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <button class="btn btn-success" onclick="runDemo()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ</button>
                    <button class="btn btn-secondary" onclick="clearLog()" style="margin-top: 10px;">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
                </div>
            </div>

            <div class="main-content">
                <div id="moduleContent">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥—É–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    <div class="module-section">
                        <h2 class="module-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MonkeyGram! üêµ</h2>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥—É–ª—å –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.</p>
                        <p>–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ" –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π.</p>
                    </div>
                </div>

                <div class="demo-controls">
                    <h3>–ö–æ–Ω—Å–æ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                    <div class="log-output" id="logOutput">
// –õ–æ–≥–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // MonkeyGram - –ü–æ–ª–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
        // –í–µ—Å—å –∫–æ–¥ JavaScript –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∏–∂–µ

        class EventBus {
            constructor() {
                this.listeners = new Map();
            }

            on(event, callback) {
                if (!this.listeners.has(event)) {
                    this.listeners.set(event, []);
                }
                this.listeners.get(event).push(callback);
            }

            emit(event, data) {
                if (this.listeners.has(event)) {
                    this.listeners.get(event).forEach(callback => {
                        try {
                            callback(data);
                        } catch (e) {
                            this.log(`–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–±—ã—Ç–∏—è ${event}: ${e.message}`);
                        }
                    });
                }
            }

            off(event, callback) {
                if (this.listeners.has(event)) {
                    const filtered = this.listeners.get(event).filter(cb => cb !== callback);
                    this.listeners.set(event, filtered);
                }
            }
        }

        class MonkeyGram {
            constructor() {
                this.eventBus = new EventBus();
                this.store = {
                    users: [],
                    chats: [],
                    messages: [],
                    channels: [],
                    polls: [],
                    calls: [],
                    blockedUsers: [],
                    encryptedChats: new Set()
                };
                this.currentUser = null;
                this.settings = {
                    theme: 'light',
                    privacy: {
                        lastSeen: 'everyone'
                    },
                    autoDownload: {
                        wifi: true,
                        mobile: false,
                        roaming: false
                    }
                };

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
                this.core = new CoreModule(this);
                this.experience = new ExperienceModule(this);
                this.security = new SecurityModule(this);
                this.productivity = new ProductivityModule(this);
                this.customization = new CustomizationModule(this);
                this.technical = new TechnicalModule(this);

                // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
                this.setupEventListeners();
                
                this.log('MonkeyGram –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω! üêµ');
            }

            setupEventListeners() {
                this.eventBus.on('user:registered', (user) => {
                    this.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${user.name}`);
                });

                this.eventBus.on('user:loggedIn', (user) => {
                    this.currentUser = user;
                    this.updateUserInfo();
                    this.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª: ${user.name}`);
                });

                this.eventBus.on('user:loggedOut', () => {
                    this.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                });

                this.eventBus.on('message:sent', (data) => {
                    this.log(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç ${data.chatId}: ${data.text}`);
                });

                this.eventBus.on('message:edited', (data) => {
                    this.log(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${data.messageId}`);
                });

                this.eventBus.on('chat:created', (chat) => {
                    this.log(`–ß–∞—Ç —Å–æ–∑–¥–∞–Ω: ${chat.name} (ID: ${chat.id})`);
                });

                this.eventBus.on('encryption:enabled', (chatId) => {
                    this.log(`–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ –¥–ª—è —á–∞—Ç–∞: ${chatId}`);
                });
            }

            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = `[${timestamp}] ${message}\n`;
                const logOutput = document.getElementById('logOutput');
                if (logOutput) {
                    logOutput.textContent += logEntry;
                    logOutput.scrollTop = logOutput.scrollHeight;
                }
                console.log(`MonkeyGram: ${message}`);
            }

            updateUserInfo() {
                const userInfo = document.getElementById('userInfo');
                const userStatus = document.getElementById('userStatus');
                
                if (this.currentUser) {
                    userInfo.innerHTML = `
                        <h3>${this.currentUser.name}</h3>
                        <p>Email: ${this.currentUser.email}</p>
                        <p>–°—Ç–∞—Ç—É—Å: <span id="userStatus" class="status-online">–û–Ω–ª–∞–π–Ω</span></p>
                    `;
                } else {
                    userInfo.innerHTML = `
                        <h3>–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</h3>
                        <p>–°—Ç–∞—Ç—É—Å: <span id="userStatus" class="status-offline">–û—Ñ—Ñ–ª–∞–π–Ω</span></p>
                    `;
                }
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
            _generateId() {
                return Math.random().toString(36).substr(2, 9);
            }

            _findUserById(userId) {
                return this.store.users.find(u => u.id === userId);
            }

            _findChatById(chatId) {
                return this.store.chats.find(c => c.id === chatId);
            }

            _findMessageById(messageId) {
                return this.store.messages.find(m => m.id === messageId);
            }
        }

        // –ú–æ–¥—É–ª—å Core (–ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
        class CoreModule {
            constructor(app) {
                this.app = app;
            }

            registerUser(email, password, name = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å') {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const user = {
                            id: this.app._generateId(),
                            email,
                            password, // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ —Ö—ç—à–∏—Ä–æ–≤–∞—Ç—å!
                            name,
                            avatar: null,
                            status: 'online',
                            lastSeen: new Date()
                        };

                        this.app.store.users.push(user);
                        this.app.eventBus.emit('user:registered', user);
                        
                        this.app.log(`–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${name} (${email})`);
                        resolve(user);
                    }, 500);
                });
            }

            loginUser(email, password) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        const user = this.app.store.users.find(u => 
                            u.email === email && u.password === password
                        );

                        if (user) {
                            user.lastSeen = new Date();
                            user.status = 'online';
                            this.app.eventBus.emit('user:loggedIn', user);
                            resolve(user);
                        } else {
                            this.app.log('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                            reject(new Error('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'));
                        }
                    }, 500);
                });
            }

            updateUserProfile(profileData) {
                if (!this.app.currentUser) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                }

                Object.assign(this.app.currentUser, profileData);
                this.app.log(`–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω: ${JSON.stringify(profileData)}`);
                this.app.updateUserInfo();
                return Promise.resolve(this.app.currentUser);
            }

            setUserStatus(status) {
                if (!this.app.currentUser) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                }

                this.app.currentUser.status = status;
                this.app.log(`–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${status}`);
                this.app.updateUserInfo();
                return Promise.resolve();
            }

            sendTextMessage(chatId, text) {
                if (!this.app.currentUser) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                }

                const message = {
                    id: this.app._generateId(),
                    chatId,
                    senderId: this.app.currentUser.id,
                    text,
                    timestamp: new Date(),
                    edited: false,
                    deleted: false
                };

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
                if (this.app.store.encryptedChats.has(chatId)) {
                    message.encrypted = true;
                    message.text = this._encryptText(text);
                }

                this.app.store.messages.push(message);
                this.app.eventBus.emit('message:sent', { chatId, text, messageId: message.id });
                
                return Promise.resolve(message);
            }

            sendMediaMessage(chatId, file) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const message = {
                            id: this.app._generateId(),
                            chatId,
                            senderId: this.app.currentUser.id,
                            type: 'media',
                            file,
                            timestamp: new Date()
                        };
                        
                        this.app.store.messages.push(message);
                        this.app.log(`–ú–µ–¥–∏–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç ${chatId}: ${file.name || file.type}`);
                        resolve(message);
                    }, 300);
                });
            }

            editMessage(messageId, newText) {
                const message = this.app._findMessageById(messageId);
                
                if (!message) {
                    throw new Error('–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                }

                if (message.senderId !== this.app.currentUser.id) {
                    throw new Error('–ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                }

                message.text = newText;
                message.edited = true;
                message.editTimestamp = new Date();

                this.app.eventBus.emit('message:edited', { messageId, newText });
                return Promise.resolve(message);
            }

            deleteMessage(messageId, forEveryone = false) {
                const message = this.app._findMessageById(messageId);
                
                if (!message) {
                    throw new Error('–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                }

                if (forEveryone || message.senderId === this.app.currentUser.id) {
                    message.deleted = true;
                    this.app.log(`–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ: ${messageId}`);
                } else {
                    // –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    this.app.log(`–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ –¥–ª—è –≤–∞—Å: ${messageId}`);
                }

                return Promise.resolve();
            }

            createGroupChat(name, userIds) {
                const chat = {
                    id: this.app._generateId(),
                    name,
                    type: 'group',
                    userIds: [...userIds, this.app.currentUser.id],
                    createdBy: this.app.currentUser.id,
                    createdAt: new Date(),
                    pinnedMessage: null
                };

                this.app.store.chats.push(chat);
                this.app.eventBus.emit('chat:created', chat);
                
                return Promise.resolve(chat);
            }

            addUserToChat(chatId, userId) {
                const chat = this.app._findChatById(chatId);
                
                if (!chat) {
                    throw new Error('–ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                if (!chat.userIds.includes(userId)) {
                    chat.userIds.push(userId);
                    this.app.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç ${chat.name}`);
                }

                return Promise.resolve(chat);
            }

            _encryptText(text) {
                // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
                return btoa(text); // Base64 –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            }

            _decryptText(encryptedText) {
                // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
                return atob(encryptedText);
            }
        }

        // –ú–æ–¥—É–ª—å Experience (–£–ª—É—á—à–µ–Ω–∏–µ –æ–±—â–µ–Ω–∏—è)
        class ExperienceModule {
            constructor(app) {
                this.app = app;
                this.activeCalls = new Map();
            }

            sendVoiceMessage(chatId, audioBlob) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const message = {
                            id: this.app._generateId(),
                            chatId,
                            senderId: this.app.currentUser.id,
                            type: 'voice',
                            duration: audioBlob.duration || 5,
                            timestamp: new Date()
                        };
                        
                        this.app.store.messages.push(message);
                        this.app.log(`–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç ${chatId}`);
                        resolve(message);
                    }, 300);
                });
            }

            startVoiceCall(chatId) {
                const callId = this.app._generateId();
                const call = {
                    id: callId,
                    chatId,
                    type: 'voice',
                    participants: [this.app.currentUser.id],
                    startTime: new Date(),
                    active: true
                };

                this.app.store.calls.push(call);
                this.activeCalls.set(callId, call);
                
                this.app.log(`–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫ –Ω–∞—á–∞—Ç –≤ —á–∞—Ç–µ ${chatId}`);
                return Promise.resolve(call);
            }

            startVideoCall(chatId) {
                const callId = this.app._generateId();
                const call = {
                    id: callId,
                    chatId,
                    type: 'video',
                    participants: [this.app.currentUser.id],
                    startTime: new Date(),
                    active: true,
                    videoEnabled: true
                };

                this.app.store.calls.push(call);
                this.activeCalls.set(callId, call);
                
                this.app.log(`–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫ –Ω–∞—á–∞—Ç –≤ —á–∞—Ç–µ ${chatId}`);
                return Promise.resolve(call);
            }

            toggleCamera(state) {
                const activeCall = Array.from(this.activeCalls.values())
                    .find(call => call.participants.includes(this.app.currentUser.id));

                if (activeCall && activeCall.type === 'video') {
                    activeCall.videoEnabled = state;
                    this.app.log(`–ö–∞–º–µ—Ä–∞ ${state ? '–≤–∫–ª—é—á–µ–Ω–∞' : '–≤—ã–∫–ª—é—á–µ–Ω–∞'}`);
                }

                return Promise.resolve();
            }

            createChannel(name, description) {
                const channel = {
                    id: this.app._generateId(),
                    name,
                    description,
                    creatorId: this.app.currentUser.id,
                    subscribers: [this.app.currentUser.id],
                    createdAt: new Date(),
                    isPublic: true
                };

                this.app.store.channels.push(channel);
                this.app.log(`–ö–∞–Ω–∞–ª —Å–æ–∑–¥–∞–Ω: ${name}`);
                
                return Promise.resolve(channel);
            }
        }

        // –ú–æ–¥—É–ª—å Security (–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å)
        class SecurityModule {
            constructor(app) {
                this.app = app;
            }

            enableEndToEndEncryption(chatId) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        this.app.store.encryptedChats.add(chatId);
                        this.app.eventBus.emit('encryption:enabled', chatId);
                        
                        // –®–∏—Ñ—Ä—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                        const messages = this.app.store.messages.filter(m => m.chatId === chatId);
                        messages.forEach(message => {
                            if (!message.encrypted) {
                                message.encrypted = true;
                                message.text = btoa(message.text);
                            }
                        });

                        resolve(true);
                    }, 1000);
                });
            }

            setChatTimer(chatId, duration) {
                const chat = this.app._findChatById(chatId);
                if (chat) {
                    chat.selfDestructTimer = duration;
                    this.app.log(`–¢–∞–π–º–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è —á–∞—Ç–∞ ${chatId}: ${duration} —Å–µ–∫—É–Ω–¥`);
                }
                return Promise.resolve();
            }

            blockUser(userId) {
                if (!this.app.store.blockedUsers.includes(userId)) {
                    this.app.store.blockedUsers.push(userId);
                    this.app.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: ${userId}`);
                }
                return Promise.resolve();
            }

            enableTwoFactorAuth() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.app.currentUser) {
                            this.app.currentUser.twoFactorEnabled = true;
                            this.app.log('–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞');
                            resolve({ success: true, backupCodes: ['123456', '789012', '345678'] });
                        } else {
                            resolve({ success: false, error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' });
                        }
                    }, 800);
                });
            }

            togglePrivacyLastSeen(mode) {
                this.app.settings.privacy.lastSeen = mode;
                this.app.log(`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: ${mode}`);
                return Promise.resolve();
            }
        }

        // –ú–æ–¥—É–ª—å Productivity (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
        class ProductivityModule {
            constructor(app) {
                this.app = app;
            }

            searchMessages(query) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const results = this.app.store.messages
                            .filter(m => 
                                m.text && 
                                m.text.toLowerCase().includes(query.toLowerCase()) &&
                                !m.deleted
                            )
                            .slice(0, 20); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        
                        this.app.log(`–ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π: –Ω–∞–π–¥–µ–Ω–æ ${results.length} –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}"`);
                        resolve(results);
                    }, 300);
                });
            }

            pinMessage(chatId, messageId) {
                const chat = this.app._findChatById(chatId);
                if (chat) {
                    chat.pinnedMessage = messageId;
                    this.app.log(`–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –≤ —á–∞—Ç–µ ${chatId}`);
                }
                return Promise.resolve();
            }

            createPoll(chatId, question, options) {
                const poll = {
                    id: this.app._generateId(),
                    chatId,
                    question,
                    options: options.map((opt, idx) => ({
                        id: idx,
                        text: opt,
                        votes: 0,
                        voters: []
                    })),
                    creatorId: this.app.currentUser.id,
                    createdAt: new Date(),
                    isActive: true
                };

                this.app.store.polls.push(poll);
                this.app.log(`–û–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω: "${question}"`);
                
                return Promise.resolve(poll);
            }

            remindAboutMessage(messageId, datetime) {
                const reminder = {
                    id: this.app._generateId(),
                    messageId,
                    userId: this.app.currentUser.id,
                    remindAt: datetime,
                    createdAt: new Date()
                };

                // –ò–º–∏—Ç–∞—Ü–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
                setTimeout(() => {
                    this.app.log(`–ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ${messageId}`);
                }, 1000); // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

                this.app.log(`–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ ${datetime}`);
                return Promise.resolve(reminder);
            }
        }

        // –ú–æ–¥—É–ª—å Customization (–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è)
        class CustomizationModule {
            constructor(app) {
                this.app = app;
            }

            setAppTheme(themeName) {
                this.app.settings.theme = themeName;
                document.body.style.background = themeName === 'dark' 
                    ? '#1a1a2e' 
                    : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                this.app.log(`–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${themeName}`);
                return Promise.resolve();
            }

            setChatWallpaper(chatId, imageUrl) {
                const chat = this.app._findChatById(chatId);
                if (chat) {
                    chat.wallpaper = imageUrl;
                    this.app.log(`–û–±–æ–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —á–∞—Ç–∞ ${chatId}`);
                }
                return Promise.resolve();
            }

            sendGIF(chatId, searchQuery) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const message = {
                            id: this.app._generateId(),
                            chatId,
                            senderId: this.app.currentUser.id,
                            type: 'gif',
                            searchQuery,
                            gifUrl: `https://example.com/gif/${encodeURIComponent(searchQuery)}.gif`,
                            timestamp: new Date()
                        };
                        
                        this.app.store.messages.push(message);
                        this.app.log(`GIF –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: "${searchQuery}" –≤ —á–∞—Ç ${chatId}`);
                        resolve(message);
                    }, 400);
                });
            }

            playInChatGame(chatId, gameName) {
                this.app.log(`–ò–≥—Ä–∞ "${gameName}" –∑–∞–ø—É—â–µ–Ω–∞ –≤ —á–∞—Ç–µ ${chatId}`);
                return Promise.resolve({
                    gameId: this.app._generateId(),
                    gameName,
                    chatId,
                    players: [this.app.currentUser.id],
                    startedAt: new Date()
                });
            }
        }

        // –ú–æ–¥—É–ª—å Technical (–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ)
        class TechnicalModule {
            constructor(app) {
                this.app = app;
            }

            clearChatHistory(chatId) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        // –ü–æ–º–µ—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–µ
                        this.app.store.messages
                            .filter(m => m.chatId === chatId)
                            .forEach(m => m.deleted = true);
                        
                        this.app.log(`–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ ${chatId} –æ—á–∏—â–µ–Ω–∞`);
                        resolve(true);
                    }, 500);
                });
            }

            exportChatData(chatId) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const chat = this.app._findChatById(chatId);
                        const messages = this.app.store.messages
                            .filter(m => m.chatId === chatId && !m.deleted);
                        
                        const exportData = {
                            chat,
                            messages,
                            exportDate: new Date(),
                            totalMessages: messages.length
                        };

                        // –ò–º–∏—Ç–∞—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
                        const dataStr = JSON.stringify(exportData, null, 2);
                        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                        
                        this.app.log(`–î–∞–Ω–Ω—ã–µ —á–∞—Ç–∞ ${chatId} —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (${messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π)`);
                        resolve({ data: exportData, downloadUrl: dataUri });
                    }, 1000);
                });
            }

            toggleAutoDownloadMedia(networkType) {
                if (this.app.settings.autoDownload.hasOwnProperty(networkType)) {
                    this.app.settings.autoDownload[networkType] = 
                        !this.app.settings.autoDownload[networkType];
                    
                    const state = this.app.settings.autoDownload[networkType] ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ';
                    this.app.log(`–ê–≤—Ç–æ—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–ª—è ${networkType}: ${state}`);
                }
                return Promise.resolve();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MonkeyGram
        let messenger = new MonkeyGram();

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
        function showModule(moduleName) {
            const moduleContent = document.getElementById('moduleContent');
            let content = '';

            switch(moduleName) {
                case 'core':
                    content = `
                        <div class="module-section">
                            <h2 class="module-title">Core - –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h2>
                            <div class="function-grid">
                                <div class="function-card">
                                    <h4>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
                                    <button onclick="testRegister()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h4>
                                    <button onclick="testLogin()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h4>
                                    <button onclick="testSendMessage()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h4>
                                    <button onclick="testEditMessage()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç</h4>
                                    <button onclick="testCreateGroup()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'experience':
                    content = `
                        <div class="module-section">
                            <h2 class="module-title">Experience - –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—â–µ–Ω–∏—è</h2>
                            <div class="function-grid">
                                <div class="function-card">
                                    <h4>–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</h4>
                                    <button onclick="testVoiceMessage()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫</h4>
                                    <button onclick="testVoiceCall()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫</h4>
                                    <button onclick="testVideoCall()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª</h4>
                                    <button onclick="testCreateChannel()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'security':
                    content = `
                        <div class="module-section">
                            <h2 class="module-title">Security - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
                            <div class="function-grid">
                                <div class="function-card">
                                    <h4>–í–∫–ª—é—á–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h4>
                                    <button onclick="testEncryption()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
                                    <button onclick="testBlockUser()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>2FA –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h4>
                                    <button onclick="testTwoFactor()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</h4>
                                    <button onclick="testPrivacy()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'productivity':
                    content = `
                        <div class="module-section">
                            <h2 class="module-title">Productivity - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h2>
                            <div class="function-grid">
                                <div class="function-card">
                                    <h4>–ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π</h4>
                                    <button onclick="testSearch()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h4>
                                    <button onclick="testPinMessage()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å</h4>
                                    <button onclick="testCreatePoll()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</h4>
                                    <button onclick="testReminder()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'customization':
                    content = `
                        <div class="module-section">
                            <h2 class="module-title">Customization - –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è</h2>
                            <div class="function-grid">
                                <div class="function-card">
                                    <h4>–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</h4>
                                    <button onclick="testChangeTheme()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–û—Ç–ø—Ä–∞–≤–∏—Ç—å GIF</h4>
                                    <button onclick="testSendGIF()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–ò–≥—Ä–∞ –≤ —á–∞—Ç–µ</h4>
                                    <button onclick="testChatGame()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'technical':
                    content = `
                        <div class="module-section">
                            <h2 class="module-title">Technical - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</h2>
                            <div class="function-grid">
                                <div class="function-card">
                                    <h4>–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</h4>
                                    <button onclick="testClearHistory()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
                                    <button onclick="testExportData()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                                <div class="function-card">
                                    <h4>–ê–≤—Ç–æ—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ</h4>
                                    <button onclick="testAutoDownload()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }

            moduleContent.innerHTML = content;
        }

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function testRegister() {
            messenger.core.registerUser('user@example.com', 'password123', '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å')
                .then(user => {
                    messenger.log(`‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞: ${user.name}`);
                })
                .catch(err => messenger.log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`));
        }

        function testLogin() {
            messenger.core.loginUser('user@example.com', 'password123')
                .then(user => {
                    messenger.log(`‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: ${user.name}`);
                })
                .catch(err => messenger.log(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${err.message}`));
        }

        function testSendMessage() {
            if (!messenger.currentUser) {
                messenger.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const chatId = 'chat_' + Date.now();
            messenger.core.sendTextMessage(chatId, '–ü—Ä–∏–≤–µ—Ç, MonkeyGram! üêµ')
                .then(msg => {
                    messenger.log(`‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: "${msg.text}"`);
                });
        }

        function testEditMessage() {
            if (!messenger.currentUser) {
                messenger.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const chatId = 'edit_test_chat';
            messenger.core.sendTextMessage(chatId, '–°—Ç–∞—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ')
                .then(msg => {
                    setTimeout(() => {
                        messenger.core.editMessage(msg.id, '–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚úèÔ∏è')
                            .then(() => messenger.log('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ'));
                    }, 1000);
                });
        }

        function testCreateGroup() {
            if (!messenger.currentUser) {
                messenger.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            messenger.core.createGroupChat('–¢–µ—Å—Ç–æ–≤–∞—è –≥—Ä—É–ø–ø–∞', ['user1', 'user2', 'user3'])
                .then(chat => {
                    messenger.log(`‚úÖ –ì—Ä—É–ø–ø–∞ —Å–æ–∑–¥–∞–Ω–∞: ${chat.name} —Å ${chat.userIds.length} —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏`);
                });
        }

        function testVoiceMessage() {
            if (!messenger.currentUser) {
                messenger.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            messenger.experience.sendVoiceMessage('voice_chat', { duration: 10 })
                .then(() => messenger.log('‚úÖ –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'));
        }

        function testVoiceCall() {
            if (!messenger.currentUser) {
                messenger.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            messenger.experience.startVoiceCall('call_chat')
                .then(call => messenger.log(`‚úÖ –ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫ –Ω–∞—á–∞—Ç: ${call.id}`));
        }

        function testVideoCall() {
            if (!messenger.currentUser) {
                messenger.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            messenger.experience.startVideoCall('video_chat')
                .then(call => messenger.log(`‚úÖ –í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫ –Ω–∞—á–∞—Ç: ${call.id}`));
        }

        function testCreateChannel() {
            if (!messenger.currentUser) {
                messenger.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            messenger.experience.createChannel('–ù–æ–≤–æ—Å—Ç–∏ MonkeyGram', '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞')
                .then(channel => messenger.log(`‚úÖ –ö–∞–Ω–∞–ª —Å–æ–∑–¥–∞–Ω: ${channel.name}`));
        }

        function testEncryption() {
            messenger.security.enableEndToEndEncryption('secure_chat')
                .then(() => messenger.log('‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ –¥–ª—è —á–∞—Ç–∞'));
        }

        function testBlockUser() {
            messenger.security.blockUser('spam_user')
                .then(() => messenger.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'));
        }

        function testTwoFactor() {
            messenger.security.enableTwoFactorAuth()
                .then(result => {
                    if (result.success) {
                        messenger.log('‚úÖ 2FA –≤–∫–ª—é—á–µ–Ω–∞. –ö–æ–¥—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.');
                    }
                });
        }

        function testPrivacy() {
            messenger.security.togglePrivacyLastSeen('nobody')
                .then(() => messenger.log('‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞: "–Ω–∏–∫—Ç–æ –Ω–µ –≤–∏–¥–∏—Ç"'));
        }

        function testSearch() {
            messenger.productivity.searchMessages('–ø—Ä–∏–≤–µ—Ç')
                .then(results => {
                    messenger.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${results.length} —Å–æ–æ–±—â–µ–Ω–∏–π`);
                });
        }

        function testPinMessage() {
            messenger.productivity.pinMessage('general_chat', 'msg_123')
                .then(() => messenger.log('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ'));
        }

        function testCreatePoll() {
            messenger.productivity.createPoll('poll_chat', '–ö–∞–∫–æ–π –º–æ–¥—É–ª—å –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –±–æ–ª—å—à–µ?', 
                ['Core', 'Security', 'Experience', 'Customization'])
                .then(poll => messenger.log(`‚úÖ –û–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω: "${poll.question}"`));
        }

        function testReminder() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            messenger.productivity.remindAboutMessage('msg_123', tomorrow)
                .then(() => messenger.log('‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'));
        }

        function testChangeTheme() {
            const theme = messenger.settings.theme === 'light' ? 'dark' : 'light';
            messenger.customization.setAppTheme(theme)
                .then(() => messenger.log(`‚úÖ –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ ${theme}`));
        }

        function testSendGIF() {
            messenger.customization.sendGIF('fun_chat', 'happy monkey')
                .then(() => messenger.log('‚úÖ GIF –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω'));
        }

        function testChatGame() {
            messenger.customization.playInChatGame('game_chat', '–®–∞—Ö–º–∞—Ç—ã')
                .then(game => messenger.log(`‚úÖ –ò–≥—Ä–∞ "${game.gameName}" –∑–∞–ø—É—â–µ–Ω–∞`));
        }

        function testClearHistory() {
            messenger.technical.clearChatHistory('old_chat')
                .then(() => messenger.log('‚úÖ –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞'));
        }

        function testExportData() {
            messenger.technical.exportChatData('export_chat')
                .then(result => {
                    messenger.log(`‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (${result.data.totalMessages} —Å–æ–æ–±—â–µ–Ω–∏–π)`);
                });
        }

        function testAutoDownload() {
            messenger.technical.toggleAutoDownloadMedia('wifi')
                .then(() => {
                    const state = messenger.settings.autoDownload.wifi ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–≤—ã–∫–ª—é—á–µ–Ω–æ';
                    messenger.log(`‚úÖ –ê–≤—Ç–æ—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–ª—è Wi-Fi: ${state}`);
                });
        }

        function runDemo() {
            messenger.log('üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ MonkeyGram...');
            
            // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
            setTimeout(() => testRegister(), 500);
            setTimeout(() => testLogin(), 1500);
            setTimeout(() => testSendMessage(), 2500);
            setTimeout(() => testEncryption(), 3500);
            setTimeout(() => testCreateGroup(), 4500);
            setTimeout(() => testVideoCall(), 5500);
            setTimeout(() => testCreatePoll(), 6500);
            setTimeout(() => testChangeTheme(), 7500);
            setTimeout(() => {
                messenger.log('üéâ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
            }, 8500);
        }

        function clearLog() {
            document.getElementById('logOutput').textContent = '// –õ–æ–≥–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...\n';
            messenger.log('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            messenger.log('–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å MonkeyGram –∑–∞–≥—Ä—É–∂–µ–Ω');
            messenger.log('–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥—É–ª—å –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–º–æ');
        });
    </script>
</body>
</html>
